{exp:rss:feed weblog="{segment_1}" show_future_entries="yes"}
<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"
    xmlns:dc="http://purl.org/dc/elements/1.1/"
    xmlns:atom="http://www.w3.org/2005/Atom">

    <channel>
    <title>
      {exp:xml_encode}
        {site_name} Events
        {if segment_3} | 
          {if segment_3 == "locations"}{segment_5}, {segment_4}{/if}
          {if segment_3 == "date"}{exp:nice_date date="{segment_4}-{segment_5}" format="%F %Y"}{/if}
          {if segment_3 != "date" || segment_3 != "locations"}{segment_4_category_name}{/if}
        {/if}
      {/exp:xml_encode}
    </title>
    <link>{site_url}{exp:xml_encode}?utm_source=Events&utm_medium=RSS&utm_campaign={if segment_3 == "sponsors"}{segment_4_category_url}{if:else}Events{/if}{/exp:xml_encode}</link>
    <description>The latest events from the {site_name}</description>
    <dc:language>{weblog_language}</dc:language>
    <dc:rights>Copyright {gmt_date format="%Y"}</dc:rights>
    <pubDate>{gmt_date format="%D, %d %M %Y %H:%i:%s %T"}</pubDate>

    <atom:link href="{site_url}events/rss{if segment_3}{segment_3}/{/if}{if segment_4}{segment_4}/{/if}{if segment_5}{segment_5}/{/if}" rel="self" type="application/rss+xml" />
    
{exp:weblog:entries 
  weblog="{segment_1}"
    limit="50"
    rdf="off"
    dynamic_start="on"
    disable="member_data|trackbacks|pagination"
    status="open"
    show_future_entries="yes"
    {if segment_3}
      {if segment_3 != "locations"}category="{segment_4_category_id}"{/if}
      {if segment_3 == "locations"}search:event_state="={segment_4}" search:event_city="={segment_5}"{/if}
    {/if}
}
    <item>
      <title>{exp:xml_encode protect_entities="yes"}{title}{/exp:xml_encode}</title>
      <dc:creator>{screen_name}</dc:creator>
      <link>{title_permalink="events/detail"}{exp:xml_encode}?utm_source=Events&utm_medium=RSS&utm_campaign=title{/exp:xml_encode}</link>
      <guid isPermaLink="false">{title_permalink="events/detail"}#id:{entry_id}#date:{gmt_entry_date format="%H:%i"}</guid>
      <description>
        <![CDATA[
          {exp:textile}{event_description}{/exp:textile}
          <h3>Sponsored by:</h3>
          {categories show_group="24"}
            <p><a href="{site_url}locations/detail/{category_url_title}{exp:xml_encode}?utm_source=Events&utm_medium=RSS&utm_campaign=sponsored+by{/exp:xml_encode}">{category_name}</a></p>
          {/categories}
          <h3>Date</h3>
          <p>
            {!-- Check if event is only on one date and time is set --}
            {if event_start_date == event_end_date && event_start_time !=""}
              <span class="start-time">{exp:nice_date date="{event_start_time}" format="%g:%i %a"}</span> to 
              <span class="end-time">{exp:nice_date date="{event_end_time}" format="%g:%i %a"}</span>,
              <span class="month">{exp:nice_date date="{event_start_date}" format="%F"}</span>
              <span class="day">{exp:nice_date date="{event_start_date}" format="%j"}</span>,
              <span class="year">{exp:nice_date date="{event_end_date}" format="%Y"}</span>
            {/if}
            
            {!-- Check if event is only on one date and time is NOT set --}
            {if event_start_date == event_end_date && event_start_time ==""}
              <span class="month">{exp:nice_date date="{event_start_date}" format="%F"}</span>
              <span class="day">{exp:nice_date date="{event_start_date}" format="%j"}</span>,
              <span class="year">{exp:nice_date date="{event_end_date}" format="%Y"}</span>
            {/if}
            
            {!-- Check to see if repeating event --}
            {if (event_start_date != event_end_date) && event_start_time !=""}
              <span class="start-time">{exp:nice_date date="{event_start_time}" format="%g:%i %a"}</span>,
              <span class="month">{exp:nice_date date="{event_start_date}" format="%F"}</span>
              <span class="day">{exp:nice_date date="{event_start_date}" format="%j"}</span> to 
              <span class="end-time">{exp:nice_date date="{event_end_time}" format="%g:%i %a"}</span>,
              <span class="month">{exp:nice_date date="{event_end_date}" format="%F"}</span>
              <span class="day">{exp:nice_date date="{event_end_date}" format="%j"}</span>,
              <span class="year">{exp:nice_date date="{event_end_date}" format="%Y"}</span>
            {/if}
            
            {!-- Check to see if repeating event and time is NOT set --}
            {if (event_start_date != event_end_date) && event_start_time == ""}
              <span class="month">{exp:nice_date date="{event_start_date}" format="%F"}</span>
              <span class="day">{exp:nice_date date="{event_start_date}" format="%j"}</span> to 
              <span class="month">{exp:nice_date date="{event_end_date}" format="%F"}</span>
              <span class="day">{exp:nice_date date="{event_end_date}" format="%j"}</span>,
              <span class="year">{exp:nice_date date="{event_end_date}" format="%Y"}</span>
            {/if}
          </p>
          <h3>Location</h3>
          <p>{if event_location_name}{event_location_name}{/if}<br />{event_address}<br />{event_city}, {event_state} {event_zip}</p>
          <hr>
          <p>See Event on <a href="{title_permalink="events/detail"}{exp:xml_encode}?utm_source=Events&utm_medium=RSS&utm_campaign=see+more{/exp:xml_encode}">{site_name}</a>.</p>
        ]]>
      </description>
      {categories}<category>{exp:xml_encode protect_entities="yes"}{category_name}{/exp:xml_encode}</category>
      {/categories}
      <pubDate>{gmt_entry_date format="%D, %d %M %Y %H:%i %T"}</pubDate>
    </item>
{/exp:weblog:entries}

    </channel>
</rss>
{/exp:rss:feed}